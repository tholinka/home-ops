---
machine:
  sysctls:
    fs.inotify.max_user_watches: 1048576 # Watchdog
    fs.inotify.max_user_instances: 8192 # Watchdog
    net.core.default_qdisc: fq # 10Gb/s
    net.core.rmem_max: 67108864 # 10Gb/s | Cloudflared / QUIC
    net.core.wmem_max: 67108864 # 10Gb/s | Cloudflared / QUIC
    net.ipv4.neigh.default.gc_thresh1: 4096
    net.ipv4.neigh.default.gc_thresh2: 8192
    net.ipv4.neigh.default.gc_thresh3: 16384
    net.ipv4.ping_group_range: 0 2147483647
    net.ipv4.tcp_congestion_control: bbr # 10Gb/s
    net.ipv4.tcp_fastopen: 3 # Send and accept data in the opening SYN packet
    net.ipv4.tcp_mtu_probing: 1 # Jumbo frames
    net.ipv4.tcp_notsent_lowat: 131072
    net.ipv4.tcp_rmem: 4096 87380 33554432 # 10Gb/s
    net.ipv4.tcp_wmem: 4096 65536 33554432 # 10Gb/s
    net.ipv4.tcp_slow_start_after_idle: 0
    net.ipv4.tcp_window_scaling: 1 # 10Gb/s
    sunrpc.tcp_slot_table_entries: 128 # 10Gb/s | NFS
    sunrpc.tcp_max_slot_table_entries: 128 # 10Gb/s | NFS
    vm.dirty_writeback_centisecs: 3000 # aggregate more writes together, don't wake up drives as often. default is 500 (aka 5s)
    vm.nr_hugepages: 1024 # PostgreSQL
    user.max_user_namespaces: 11255 # User Namespaces requires this

    # Enable IPv6 Privacy Extensions
    net.ipv6.conf.all.use_tempaddr: 2
    net.ipv6.conf.default.use_tempaddr: 2

    # ignore router adverts so we don't get an ip we don't need
    # multus will handle it on the pods that need it
    net.ipv6.conf.bond0/30.accept_ra: 0
    net.ipv6.conf.bond0.accept_ra: 2 # this didn't use to be required, but /proc/sys/net/ipv6/conf/bond0/forwarding seems to be set now
