---
# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources: []
patches:
  # note: remove bootstrap when switching to restore. could probably also remove managed and the init step, since the user is already created?
  - target:
      kind: Cluster
    patch: |-
      kind: Cluster
      metadata:
        name: not-used
      spec:
        postgresql:
          shared_preload_libraries:
            - "vchord.so"
        bootstrap:
          initdb:
            database: immich
            owner: immich
            secret:
              name: immich-postgres-user
            dataChecksums: true
            postInitApplicationSQL:
              - CREATE EXTENSION vchord CASCADE;
              - CREATE EXTENSION earthdistance CASCADE;
              # still need these?
              - ALTER DATABASE immich SET search_path TO "$user", public, vectors;
              - ALTER SCHEMA vectors OWNER TO immich;
